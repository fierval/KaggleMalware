open System
open System.Linq
open System.IO
open System.Collections.Generic
open System.Diagnostics

#load @"utils.fsx"
open Utils

///removes trailing zero's in each file


let path = @"C:\kaggle\malware\train"
//let path = @"C:\kaggle\malware\train\presubmit"
//let path = @"c:\kaggle\malware\scratchpad\train\1dlbp"
//let path = @"c:\kaggle\malware\scrapbook\train"
//let outPath = @"c:\kaggle\malware\scrapbook\1dlbp\train"
//let outPath = @"c:\kaggle\malware\scrapbook\test"
let outPath = @"c:\kaggle\malware\train\dezero"

createOutputDir outPath
let pad = 5 // remove zeros if there are more than 5 at the end

let files = Directory.GetFiles(path, "*.bin")
let sw = Stopwatch()
sw.Start()

for f in files do
    let file = File.ReadAllBytes(f)

    let zerosAtEnd = file.Skip(file.Length - 5).Count(fun e -> e = 0uy)

    if zerosAtEnd = pad then
        let data = file.Reverse().SkipWhile(fun f -> f = 0uy).Reverse().ToArray()
        saveFile data outPath f String.Empty        
    else
        copyFile outPath f String.Empty

sw.Stop()

printfn "elapsed: %s" (sw.Elapsed.ToString())
